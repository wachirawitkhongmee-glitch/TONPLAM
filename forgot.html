<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-cartoon">

    <div class="page">
        <div class="cartoon-card">
            <h2>‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏£‡∏≠? üîë</h2>
            <p>‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏´‡πà‡∏ß‡∏á‡∏ô‡∏∞ ‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏¢</p>

            <input id="email" class="cartoon-input" type="email" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
            <button class="cartoon-btn" onclick="sendOTP()">‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            <button class="cartoon-btn secondary" onclick="location.href='login.html'">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>

    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function () {
            // ‚≠ê‚≠ê‚≠ê ‡πÉ‡∏™‡πà Public Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚≠ê‚≠ê‚≠ê
            // ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ü‡∏£‡∏µ‡∏ó‡∏µ‡πà https://www.emailjs.com/
            emailjs.init("fjbwfeGop0-ZgqyIS");
        })();
    </script>

    <script>
        function sendOTP() {
            let e = document.getElementById("email").value;
            let users = JSON.parse(localStorage.getItem("users") || "{}");
            let found = null;

            for (let u in users) { if (users[u].email == e) found = u; }

            if (!found) { alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡πâ‡∏≤ ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏ó‡∏µ‡∏ô‡∏∞"); return; }

            // Create OTP
            let otp = Math.floor(100000 + Math.random() * 900000);

            // Save to localStorage for verification
            localStorage.setItem("otp", otp);
            localStorage.setItem("otp_user", found);

            // Send Email using EmailJS
            const serviceID = "service_7s3oqo7"; // ‚≠ê ‡πÉ‡∏™‡πà Service ID
            const templateID = "template_k76cq6t"; // ‚≠ê ‡πÉ‡∏™‡πà Template ID

            const params = {
                to_email: e,
                message: otp,
                to_name: found
            };

            const btn = document.querySelector(".cartoon-btn");
            const originalText = btn.innerText;
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...";
            btn.disabled = true;

            emailjs.send(serviceID, templateID, params)
                .then(function (response) {
                    console.log('SUCCESS!', response.status, response.text);
                    alert("‡∏™‡πà‡∏á‡∏£‡∏´‡∏±‡∏™‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏• " + e + " ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡πâ‡∏≤! \n(‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡πÉ‡∏ô Junk/Spam ‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞)");
                    location.href = "verify.html";
                }, function (error) {
                    console.log('FAILED...', error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•: " + JSON.stringify(error));

                    // Fallback for demo (in case user hasn't set up keys yet)
                    alert("‡∏£‡∏∞‡∏ö‡∏ö Demo: ‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ " + otp);
                    location.href = "verify.html";
                })
                .finally(() => {
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
        }

        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>

</body>

</html>