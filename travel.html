<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="ai-service.js"></script>
</head>

<body class="bg-cartoon">

    <div class="page" style="max-width: 600px;">

        <!-- Top Bar -->
        <div class="top-bar">
            <div class="app-title" style="font-size: 1.5rem; color: #FF6F61;">Travel Helper üöÄ</div>
            <button class="icon-btn" onclick="location.href='category.html'">üîô ‡∏Å‡∏•‡∏±‡∏ö</button>
        </div>

        <h2 style="text-align: center; color: #555; margin-bottom: 20px;">‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á üöó</h2>

        <main>

            <!-- STEP 1: Problem Selection -->
            <section id="step-problem" class="active">
                <h3 style="text-align: center; color: #666; margin-bottom: 20px;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡∏≠‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏Ñ‡∏£‡∏±‡∏ö? üßê</h3>
                <div class="grid-container">
                    <div class="category-item color-blue" onclick="selectProblem('traffic')">
                        <div style="font-size: 2.5rem;">üèéÔ∏è</div>
                        <div>‡∏£‡∏ñ‡∏ï‡∏¥‡∏î</div>
                    </div>
                    <div class="category-item color-green" onclick="selectProblem('breakdown')">
                        <div style="font-size: 2.5rem;">üîß</div>
                        <div>‡∏£‡∏ñ‡πÄ‡∏™‡∏µ‡∏¢</div>
                    </div>
                    <div class="category-item color-yellow" onclick="selectProblem('no_gas')">
                        <div style="font-size: 2.5rem;">‚õΩ</div>
                        <div>‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠</div>
                    </div>
                    <div class="category-item color-pink" onclick="selectProblem('no_public_transport')">
                        <div style="font-size: 2.5rem;">üöå</div>
                        <div>‡∏£‡∏ñ‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏≤</div>
                    </div>
                    <div class="category-item" style="border-color: #BCAAA4; background: #EFEBE9;"
                        onclick="selectProblem('lost')">
                        <div style="font-size: 2.5rem;">üó∫Ô∏è</div>
                        <div>‡∏´‡∏•‡∏á‡∏ó‡∏≤‡∏á</div>
                    </div>
                    <div class="category-item" style="border-color: #FFCC80; background: #FFF3E0;"
                        onclick="selectProblem('no_money')">
                        <div style="font-size: 2.5rem;">üí∞</div>
                        <div>‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠</div>
                    </div>
                    <div class="category-item color-purple" onclick="selectProblem('bad_weather')">
                        <div style="font-size: 2.5rem;">‚õàÔ∏è</div>
                        <div>‡∏ù‡∏ô‡∏ï‡∏Å‡∏´‡∏ô‡∏±‡∏Å</div>
                    </div>
                </div>

                <!-- AI Analysis Section -->
                <div class="cartoon-card" style="margin-top: 25px; border-top: 3px dashed #eee; padding-top: 25px;">
                    <h3 style="color: #2196F3;">ü§ñ ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£‡∏Ç‡∏∂‡πâ‡∏ô</h3>
                    <textarea id="aiTravelInput" class="cartoon-input"
                        placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà... (‡πÄ‡∏ä‡πà‡∏ô '‡∏£‡∏ñ‡∏à‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏î‡πà‡∏ß‡∏ô')"
                        style="height: 80px; resize: none;" onkeypress="handleEnterTravel(event)"></textarea>
                    <button class="cartoon-btn" id="aiTravelBtn" onclick="analyzeTravelWithAI()">‚ú® ‡πÉ‡∏´‡πâ AI
                        ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤</button>
                    <p id="aiTravelStatus" style="font-size: 0.8rem; color: #888; margin-top: 5px; display: none;">
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI...</p>
                </div>
            </section>

            <!-- STEP 2: Question Flow -->
            <section id="step-questions" class="hidden">
                <div class="cartoon-card">
                    <h2 id="question-text" style="font-size: 1.5rem; color: #555;">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°...</h2>
                    <div id="question-options" class="grid-container" style="margin-top: 20px;">
                        <!-- Options will be injected by JS -->
                    </div>
                    <div class="progress-container"
                        style="margin: 20px 0; background: #eee; border-radius: 10px; height: 10px;">
                        <div id="progress"
                            style="width: 0%; background: #FF9AA2; height: 100%; border-radius: 10px; transition: width 0.3s;">
                        </div>
                    </div>
                    <button class="cartoon-btn secondary" onclick="restartApp()">
                        üîô ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
            </section>

            <!-- STEP 3: Analysis & Results -->
            <section id="step-result" class="hidden">
                <div class="cartoon-card">
                    <h2 style="font-size: 1.8rem;">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì</h2>

                    <div id="result-container" style="margin: 20px 0; text-align: left;">
                        <!-- Recommendations will be injected here -->
                    </div>

                    <div class="tutorial-section" style="text-align: left;">
                        <h3>üìç ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                        <div id="map-container"
                            style="width: 100%; height: 300px; background: #f9f9f9; border-radius: 15px; border: 2px dashed #ddd; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                            <p id="map-status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì... üõ∞Ô∏è</p>
                        </div>
                    </div>

                    <div style="margin-top: 20px;">
                        <button class="cartoon-btn" onclick="restartApp()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
                        <button class="cartoon-btn" style="background: #FF6F61; box-shadow: 0 5px 0 #D32F2F;"
                            onclick="showEmergency()">
                            üìû ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô
                        </button>
                    </div>
                </div>
            </section>

            <!-- STEP 4: Emergency Info -->
            <section id="step-emergency" class="hidden">
                <div class="cartoon-card">
                    <h2 style="color: #FF6F61;">üö® ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h2>
                    <div style="margin: 20px 0;">
                        <div class="category-item"
                            style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; padding: 15px;">
                            <span>‡πÄ‡∏´‡∏ï‡∏∏‡∏î‡πà‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏£‡πâ‡∏≤‡∏¢</span>
                            <a href="tel:191" style="font-size: 1.5rem; color: #FF6F61;">191</a>
                        </div>
                        <div class="category-item"
                            style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; padding: 15px;">
                            <span>‡πÄ‡∏à‡πá‡∏ö‡∏õ‡πà‡∏ß‡∏¢‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</span>
                            <a href="tel:1669" style="font-size: 1.5rem; color: #FF6F61;">1669</a>
                        </div>
                        <div class="category-item"
                            style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; padding: 15px;">
                            <span>‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏ó‡πà‡∏≠‡∏á‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</span>
                            <a href="tel:1155" style="font-size: 1.5rem; color: #FF6F61;">1155</a>
                        </div>
                        <div class="category-item"
                            style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; padding: 15px;">
                            <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏≤‡∏à‡∏£</span>
                            <a href="tel:1197" style="font-size: 1.5rem; color: #FF6F61;">1197</a>
                        </div>
                    </div>
                    <button class="cartoon-btn secondary" onclick="hideEmergency()">‚ùå ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>
                </div>
            </section>

        </main>

        <footer style="text-align: center; margin-top: 30px; opacity: 0.7;">
            <p>¬© 2024 Travel Helper - LifeFix Web</p>
        </footer>

    </div>

    <script src="ai-service.js"></script>
    <script src="script.js"></script>
    <script>
        function handleEnterTravel(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                analyzeTravelWithAI();
            }
        }

        async function analyzeTravelWithAI() {
            const input = document.getElementById('aiTravelInput').value.trim();
            const btn = document.getElementById('aiTravelBtn');
            const status = document.getElementById('aiTravelStatus');

            if (!input) {
                alert("‡∏•‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏û‡∏µ‡πà AI ‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏´‡πâ‡∏à‡πâ‡∏≤!");
                return;
            }

            const apiKey = AIService.getApiKey();
            if (!apiKey) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Gemini API Key ‡πÉ‡∏ô '‡∏´‡∏ô‡πâ‡∏≤‡∏™‡πà‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤' ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏≠‡∏á‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏à‡πâ‡∏≤!");
                return;
            }

            btn.disabled = true;
            status.style.display = 'block';

            try {
                const category = await AIService.analyzeTravelProblem(input);
                if (category) {
                    selectProblem(category);
                    alert(`AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö: ${problems[category].title} ü§î`);
                } else {
                    alert("‡∏Ç‡∏≠‡πÇ‡∏ó‡∏©‡∏ó‡∏µ‡∏à‡πâ‡∏≤ AI ‡∏¢‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏à‡πà‡∏≤‡∏á ‡∏•‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏ó‡∏ô‡∏ô‡∏∞‡∏à‡πä‡∏∞!");
                }
            } catch (err) {
                console.error(err);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ AI ‡∏à‡πâ‡∏≤!");
            } finally {
                btn.disabled = false;
                status.style.display = 'none';
            }
        }
    </script>
</body>

</html>